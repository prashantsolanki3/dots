---
- name: Ensure glusterfs mount directories
  file:
    path: '/mnt/{{mount}}'
    state: directory
    mode: '0755'
    owner: '{{host_username}}'
    group: '{{host_username}}'
  loop: "{{ glusterfs_mounts_list }}"
  loop_control:
    loop_var: mount
  when: glusterfs_mounts_list is defined
  become: true
  tags: ['dir-structure', 'glusterfs', 'mounts']

- name: Add GlusterFS volumes to fstab
  lineinfile:
    path: "/etc/fstab"
    line: "{{ glusterfs_server }}:/{{ mount }} /mnt/{{ mount }} glusterfs defaults,_netdev 0 0"
    state: present
  loop: "{{ glusterfs_mounts_list }}"
  loop_control:
    loop_var: mount
  when: glusterfs_mounts_list is defined
  tags: ['dir-structure', 'glusterfs']

- name: mount all
  command: mount -a
  when: glusterfs_mounts_list is defined
  become: true
  tags: ['dir-structure', 'glusterfs'] 